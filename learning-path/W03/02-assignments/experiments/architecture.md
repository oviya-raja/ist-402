# RAG System - Complete Dependency & Reuse Documentation

## Executive Summary

This document provides a comprehensive overview of the dependency chain and component reuse across all 6 objectives of the RAG (Retrieval-Augmented Generation) system implementation.

**Key Principle**: Each objective builds upon previous objectives, achieving **100% component reuse** with zero duplication.

---

## Table of Contents

1. [Complete System Diagram](#complete-system-diagram)
2. [Dependency Flow (Detailed)](#dependency-flow-detailed)
3. [Objective-by-Objective Breakdown](#objective-by-objective-breakdown)
4. [Component Reuse Matrix](#component-reuse-matrix)
5. [Data Flow Visualization](#data-flow-visualization)
6. [Function Call Chain](#function-call-chain)
7. [File Outputs](#file-outputs)
8. [Quick Reference](#quick-reference)

---

## Complete System Diagram

### Master Architecture (All 6 Objectives)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    RAG SYSTEM - COMPLETE ARCHITECTURE                         â•‘
â•‘                      (100% Component Reuse)                                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OBJECTIVE 0: Prerequisites & Environment Setup                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                               â”‚
â”‚  Creates:                                                                     â”‚
â”‚    â€¢ IN_COLAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â€¢ HAS_GPU â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚    â€¢ hf_token â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â–º â”‚
â”‚    â€¢ authenticate_hf() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚    â€¢ Packages: torch, transformers, faiss-cpu, sentence-transformers â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                               â”‚
â”‚  Reuses: NOTHING (Foundation Layer)                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OBJECTIVE 1: Mistral LLM & System Prompt                                   â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                               â”‚
â”‚  Reuses from Obj 0:                                                           â”‚
â”‚    â—„â”€â”€ hf_token              (authenticates model download)                   â”‚
â”‚    â—„â”€â”€ authenticate_hf()     (login function)                                 â”‚
â”‚    â—„â”€â”€ HAS_GPU               (decides float16 vs float32)                     â”‚
â”‚    â—„â”€â”€ torch, transformers   (model loading libraries)                        â”‚
â”‚                                                                               â”‚
â”‚  Creates:                                                                     â”‚
â”‚    â€¢ mistral_model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â€¢ mistral_tokenizer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚   â”‚
â”‚    â€¢ system_prompt â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚   â”‚
â”‚                                      â”‚                                   â”‚   â”‚
â”‚                                      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚                                      â”œâ”€â”€â”€â–ºâ”‚ Used by: Obj 2, Obj 4,    â”‚ â”‚   â”‚
â”‚                                      â”‚    â”‚            Obj 5          â”‚ â”‚   â”‚
â”‚                                      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OBJECTIVE 2: Q&A Database Generation                                       â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                               â”‚
â”‚  Reuses from Obj 1:                                                           â”‚
â”‚    â—„â”€â”€ mistral_model         (generates Q&A pairs)                           â”‚
â”‚    â—„â”€â”€ mistral_tokenizer     (tokenizes generation prompts)                   â”‚
â”‚    â—„â”€â”€ system_prompt         (provides business context)                      â”‚
â”‚                                                                               â”‚
â”‚  Creates:                                                                     â”‚
â”‚    â€¢ qa_database (21 pairs: 18 answerable + 3 unanswerable) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â€¢ qa_df (pandas DataFrame)                                              â”‚   â”‚
â”‚                                      â”‚                                     â”‚   â”‚
â”‚                                      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚                                      â”œâ”€â”€â”€â–ºâ”‚ Used by: Obj 3, Obj 4,      â”‚ â”‚   â”‚
â”‚                                      â”‚    â”‚            Obj 5             â”‚ â”‚   â”‚
â”‚                                      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OBJECTIVE 3: Vector Database (FAISS + Embeddings)                            â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                               â”‚
â”‚  Reuses from Obj 2:                                                           â”‚
â”‚    â—„â”€â”€ qa_database           (source data for embeddings)                     â”‚
â”‚                                                                               â”‚
â”‚  Creates:                                                                     â”‚
â”‚    â€¢ embedding_model (SentenceTransformer: all-MiniLM-L6-v2) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â€¢ faiss_index (IndexFlatL2: 21 vectors Ã— 384 dims) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚    â€¢ embed_query() (function: text â†’ 384-dim vector) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚    â€¢ qa_embeddings (numpy array: shape 21 Ã— 384) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                         â”‚
â”‚                                      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚                                      â”œâ”€â”€â”€â–ºâ”‚ Used by: Obj 4, Obj 5       â”‚     â”‚
â”‚                                      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OBJECTIVE 4: RAG Pipeline                                                    â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                               â”‚
â”‚  Reuses from Obj 1:              Reuses from Obj 2:     Reuses from Obj 3:    â”‚
â”‚    â—„â”€â”€ mistral_model             â—„â”€â”€ qa_database        â—„â”€â”€ embedding_model  â”‚
â”‚    â—„â”€â”€ mistral_tokenizer                                â—„â”€â”€ faiss_index      â”‚
â”‚    â—„â”€â”€ system_prompt                                    â—„â”€â”€ embed_query()    â”‚
â”‚                                                                               â”‚
â”‚  Creates:                                                                     â”‚
â”‚    â€¢ rag_query()      (main pipeline: query â†’ retrieve â†’ augment â†’ generate) â”‚
â”‚    â€¢ search_faiss()   (searches FAISS for similar vectors)                   â”‚
â”‚    â€¢ format_context() (formats retrieved Q&A as context string)              â”‚
â”‚    â€¢ RAGResult        (dataclass for pipeline results)                       â”‚
â”‚                                      â”‚                                       â”‚
â”‚                                      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                                      â””â”€â”€â”€â–ºâ”‚ Used by: Obj 5              â”‚   â”‚
â”‚                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OBJECTIVE 5: Model Evaluation & Ranking                                      â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                               â”‚
â”‚  Reuses from Obj 1:    Reuses from Obj 2:   Reuses from Obj 3:                â”‚
â”‚    â—„â”€â”€ mistral_model     â—„â”€â”€ qa_database      â—„â”€â”€ embedding_model            â”‚
â”‚    â—„â”€â”€ mistral_tokenizer    (ground truth)    â—„â”€â”€ embed_query()              â”‚
â”‚       (RAGAS optional)                                                        â”‚
â”‚                                                                               â”‚
â”‚  Reuses from Obj 4:                                                           â”‚
â”‚    â—„â”€â”€ rag_query()       (gets dynamic context for each question)            â”‚
â”‚    â—„â”€â”€ search_faiss()    (called internally by rag_query)                    â”‚
â”‚    â—„â”€â”€ format_context()  (formats retrieved documents)                       â”‚
â”‚                                                                               â”‚
â”‚  Creates:                                                                     â”‚
â”‚    â€¢ model_rankings.csv  (final output with 6 models ranked)                 â”‚
â”‚    â€¢ ModelMetrics        (dataclass for model scores)                        â”‚
â”‚    â€¢ QuestionMetrics     (dataclass for per-question scores)                 â”‚
â”‚                                                                               â”‚
â”‚  Evaluates 6 Models on 5 Metrics:                                            â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚ Models:              â”‚  â”‚ Metrics:                                  â”‚   â”‚
â”‚    â”‚  â€¢ T5-QA-Generative  â”‚  â”‚  â€¢ Accuracy (F1 Score)                    â”‚   â”‚
â”‚    â”‚  â€¢ RoBERTa-SQuAD2    â”‚  â”‚  â€¢ Confidence Handling                    â”‚   â”‚
â”‚    â”‚  â€¢ BERT-Large-SQuAD  â”‚  â”‚  â€¢ Quality (Semantic Similarity)          â”‚   â”‚
â”‚    â”‚  â€¢ DistilBERT-SQuAD  â”‚  â”‚  â€¢ Speed (Response Time)                  â”‚   â”‚
â”‚    â”‚  â€¢ BERT-Tiny-SQuAD   â”‚  â”‚  â€¢ Robustness (Edge Cases)                â”‚   â”‚
â”‚    â”‚  â€¢ MiniLM-SQuAD      â”‚  â”‚                                           â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   âœ… COMPLETE       â”‚
                            â”‚   model_rankings   â”‚
                            â”‚       .csv         â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Dependency Flow (Detailed)

### Component Creation & Reuse Timeline

```
TIME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º

     Obj 0          Obj 1           Obj 2          Obj 3          Obj 4          Obj 5
       â”‚              â”‚               â”‚              â”‚              â”‚              â”‚
       â”‚              â”‚               â”‚              â”‚              â”‚              â”‚
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”      â”Œâ”€â”€â”€â”´â”€â”€â”€â”      â”Œâ”€â”€â”€â”´â”€â”€â”€â”      â”Œâ”€â”€â”€â”´â”€â”€â”€â”      â”Œâ”€â”€â”€â”´â”€â”€â”€â”      â”Œâ”€â”€â”€â”´â”€â”€â”€â”
   â”‚CREATE â”‚      â”‚CREATE â”‚      â”‚CREATE â”‚      â”‚CREATE â”‚      â”‚CREATE â”‚      â”‚CREATE â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚hf_tokenâ”‚â”€â”€â”€â”€â”€â–ºâ”‚mistralâ”‚â”€â”€â”€â”€â”€â–ºâ”‚qa_    â”‚â”€â”€â”€â”€â”€â–ºâ”‚embed_ â”‚â”€â”€â”€â”€â”€â–ºâ”‚rag_   â”‚â”€â”€â”€â”€â”€â–ºâ”‚rankingâ”‚
   â”‚HAS_GPU â”‚      â”‚model  â”‚      â”‚databasâ”‚      â”‚model  â”‚      â”‚query()â”‚      â”‚s.csv  â”‚
   â”‚auth_hf â”‚      â”‚tokenizâ”‚      â”‚qa_df  â”‚      â”‚faiss_ â”‚      â”‚search_â”‚      â”‚       â”‚
   â”‚packagesâ”‚      â”‚sys_prmâ”‚      â”‚       â”‚      â”‚index  â”‚      â”‚faiss()â”‚      â”‚       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”˜      â”‚embed_ â”‚      â”‚format_â”‚      â”‚       â”‚
                       â”‚              â”‚         â”‚query()â”‚      â”‚contextâ”‚      â”‚       â”‚
                       â”‚              â”‚         â””â”€â”€â”€â”¬â”€â”€â”€â”˜      â””â”€â”€â”€â”¬â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚              â”‚             â”‚              â”‚
                       â”‚              â”‚             â”‚              â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
                       REUSED BY â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
                                      â”‚             â”‚              â”‚
                                   Obj 2,4,5     Obj 3,4,5      Obj 4,5         Obj 5
```

---

## Objective-by-Objective Breakdown

### Objective 0: Prerequisites & Setup

| Aspect | Details |
|--------|---------|
| **Purpose** | Environment setup, package installation, authentication |
| **Reuses** | Nothing (foundation layer) |
| **Creates** | `IN_COLAB`, `HAS_GPU`, `hf_token`, `authenticate_hf()` |
| **Packages** | `torch`, `transformers`, `sentence-transformers`, `faiss-cpu`, `ragas`, `datasets` |

```python
# Key Functions
check_environment()    # Detects Colab & GPU
get_hf_token()         # Retrieves HF token
install_packages()     # Installs dependencies
authenticate_hf()      # Logs into Hugging Face
```

---

### Objective 1: Mistral LLM Setup

| Aspect | Details |
|--------|---------|
| **Purpose** | Load Mistral-7B model, create system prompt |
| **Reuses from Obj 0** | `hf_token`, `authenticate_hf()`, `HAS_GPU`, packages |
| **Creates** | `mistral_model`, `mistral_tokenizer`, `system_prompt` |
| **Model** | `mistralai/Mistral-7B-Instruct-v0.3` (~14GB) |

```python
# Key Functions
load_mistral_model()      # Loads and caches Mistral
create_system_prompt()    # Creates customer service prompt
format_mistral_prompt()   # Formats for Mistral Instruct
generate_response()       # Generates text with model
```

---

### Objective 2: Q&A Database Generation

| Aspect | Details |
|--------|---------|
| **Purpose** | Generate synthetic Q&A pairs for RAG |
| **Reuses from Obj 1** | `mistral_model`, `mistral_tokenizer`, `system_prompt` |
| **Creates** | `qa_database` (21 pairs), `qa_df` |
| **Distribution** | 18 answerable + 3 unanswerable |

```python
# Key Functions
generate_answerable()      # Generates answerable Q&A
generate_unanswerable()    # Generates unanswerable Q&A
parse_qa_lines()           # Parses JSON output
qa_to_dataframe()          # Converts to DataFrame
```

---

### Objective 3: Vector Database (FAISS)

| Aspect | Details |
|--------|---------|
| **Purpose** | Create embeddings and FAISS index for semantic search |
| **Reuses from Obj 2** | `qa_database` |
| **Creates** | `embedding_model`, `faiss_index`, `qa_embeddings`, `embed_query()` |
| **Embedding Model** | `all-MiniLM-L6-v2` (384 dimensions) |

```python
# Key Functions
load_embedding_model()     # Loads SentenceTransformer
generate_embeddings()      # Converts text to vectors
create_faiss_index()       # Creates IndexFlatL2
embed_query()              # Converts single query to vector
retrieve_context()         # Full retrieval pipeline
```

---

### Objective 4: RAG Pipeline

| Aspect | Details |
|--------|---------|
| **Purpose** | Complete RAG: Query â†’ Retrieve â†’ Augment â†’ Generate |
| **Reuses from Obj 1** | `mistral_model`, `mistral_tokenizer`, `system_prompt` |
| **Reuses from Obj 2** | `qa_database` |
| **Reuses from Obj 3** | `embedding_model`, `faiss_index`, `embed_query()` |
| **Creates** | `rag_query()`, `search_faiss()`, `format_context()`, `RAGResult` |

```python
# Key Functions
rag_query()           # Main pipeline function
search_faiss()        # FAISS similarity search
format_context()      # Formats retrieved docs
build_prompt()        # Builds augmented prompt
generate_response()   # Generates with Mistral
```

---

### Objective 5: Model Evaluation & Ranking

| Aspect | Details |
|--------|---------|
| **Purpose** | Compare 6 QA models on 5 metrics |
| **Reuses from Obj 1** | `mistral_model`, `mistral_tokenizer` (for RAGAS) |
| **Reuses from Obj 2** | `qa_database` (ground truth) |
| **Reuses from Obj 3** | `embedding_model`, `embed_query()` |
| **Reuses from Obj 4** | `rag_query()`, `search_faiss()`, `format_context()` |
| **Creates** | `model_rankings.csv`, evaluation results |

**Models Evaluated:**

| Model | Type | Size |
|-------|------|------|
| T5-QA-Generative | text2text-generation | base |
| RoBERTa-SQuAD2 | question-answering | base |
| BERT-Large-SQuAD | question-answering | large |
| DistilBERT-SQuAD | question-answering | small |
| BERT-Tiny-SQuAD | question-answering | tiny |
| MiniLM-SQuAD | question-answering | small |

**5 Evaluation Metrics:**

| Metric | Formula | Weight | What It Measures |
|--------|---------|--------|------------------|
| **Accuracy (F1)** | `2 Ã— (P Ã— R) / (P + R)` | 25% | Word overlap with ground truth |
| **Confidence** | Custom scoring | 20% | Appropriate uncertainty handling |
| **Quality** | `cosine(embâ‚, embâ‚‚)` | 25% | Semantic meaning similarity |
| **Speed** | `1 - (time / max_time)` | 15% | Response latency |
| **Robustness** | Heuristic checks | 15% | Edge case handling |

---

## Component Reuse Matrix

| Component | Created In | Obj 0 | Obj 1 | Obj 2 | Obj 3 | Obj 4 | Obj 5 |
|-----------|-----------|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|
| `hf_token` | Obj 0 | âœ… | ðŸ”„ | - | - | - | - |
| `authenticate_hf()` | Obj 0 | âœ… | ðŸ”„ | - | - | - | - |
| `HAS_GPU` | Obj 0 | âœ… | ðŸ”„ | - | - | - | - |
| `mistral_model` | Obj 1 | - | âœ… | ðŸ”„ | - | ðŸ”„ | ðŸ”„ |
| `mistral_tokenizer` | Obj 1 | - | âœ… | ðŸ”„ | - | ðŸ”„ | ðŸ”„ |
| `system_prompt` | Obj 1 | - | âœ… | ðŸ”„ | - | ðŸ”„ | - |
| `qa_database` | Obj 2 | - | - | âœ… | ðŸ”„ | ðŸ”„ | ðŸ”„ |
| `embedding_model` | Obj 3 | - | - | - | âœ… | ðŸ”„ | ðŸ”„ |
| `faiss_index` | Obj 3 | - | - | - | âœ… | ðŸ”„ | ðŸ”„ |
| `embed_query()` | Obj 3 | - | - | - | âœ… | ðŸ”„ | ðŸ”„ |
| `qa_embeddings` | Obj 3 | - | - | - | âœ… | - | - |
| `rag_query()` | Obj 4 | - | - | - | - | âœ… | ðŸ”„ |
| `search_faiss()` | Obj 4 | - | - | - | - | âœ… | ðŸ”„ |
| `format_context()` | Obj 4 | - | - | - | - | âœ… | ðŸ”„ |

**Legend:** âœ… = Created | ðŸ”„ = Reused | - = Not Used

---

## Data Flow Visualization

### Question Processing Flow (Objective 5)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INPUT: "What is your return policy?"                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: get_rag_context(question)                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  rag_query()                                        â—„â”€â”€ FROM OBJECTIVE 4  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  embed_query(question)                           â—„â”€â”€ FROM OBJECTIVE 3â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â””â”€â”€ embedding_model.encode()                                      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â””â”€â”€ Returns: [0.023, -0.156, ..., 0.089] (384 dimensions)        â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                    â”‚                                      â”‚ â”‚
â”‚  â”‚                                    â–¼                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  search_faiss(embedding, top_k=3)                â—„â”€â”€ FROM OBJECTIVE 4â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â””â”€â”€ faiss_index.search()                      â—„â”€â”€ FROM OBJECTIVE 3â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â””â”€â”€ qa_database[indices]                      â—„â”€â”€ FROM OBJECTIVE 2â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â””â”€â”€ Returns: [Q&A pair 1, Q&A pair 2, Q&A pair 3]                â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                    â”‚                                      â”‚ â”‚
â”‚  â”‚                                    â–¼                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  format_context(retrieved_qa)                    â—„â”€â”€ FROM OBJECTIVE 4â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â””â”€â”€ Returns formatted context string                              â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: DYNAMIC CONTEXT (Retrieved from RAG)                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  "RELEVANT INFORMATION FROM KNOWLEDGE BASE:                                     â”‚
â”‚   [Source 1] (Relevance: 92%)                                                   â”‚
â”‚   Q: What is your return policy?                                                â”‚
â”‚   A: We offer a 30-day return policy with full refund for unopened items..."    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: QA Model Inference                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  model_pipeline(question=question, context=DYNAMIC_CONTEXT)                     â”‚
â”‚    â””â”€â”€ Returns: "Our return policy allows returns within 30 days for a full     â”‚
â”‚                  refund on unopened items in original packaging."               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: Calculate All 5 Metrics                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  calc_accuracy(answer, expected)                                           â”‚â”‚
â”‚  â”‚    â””â”€â”€ F1 Score: 0.82                                                      â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚  calc_confidence(raw_conf, answer, is_answerable)                          â”‚â”‚
â”‚  â”‚    â””â”€â”€ Confidence Score: 0.91                                              â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚  calc_quality(answer, expected)                     â—„â”€â”€ USES embed_query() â”‚â”‚
â”‚  â”‚    â”œâ”€â”€ embed_query(answer)                          â—„â”€â”€ FROM OBJECTIVE 3   â”‚â”‚
â”‚  â”‚    â”œâ”€â”€ embed_query(expected)                        â—„â”€â”€ FROM OBJECTIVE 3   â”‚â”‚
â”‚  â”‚    â””â”€â”€ Semantic Similarity: 0.87                                           â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚  calc_speed(response_time_ms)                                              â”‚â”‚
â”‚  â”‚    â””â”€â”€ Speed Score: 0.75                                                   â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚  calc_robustness(answer, conf, is_answerable, had_error)                   â”‚â”‚
â”‚  â”‚    â””â”€â”€ Robustness Score: 1.0                                               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OUTPUT: QuestionMetrics                                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  {                                                                              â”‚
â”‚      "question": "What is your return policy?",                                 â”‚
â”‚      "accuracy": 0.82,                                                          â”‚
â”‚      "confidence": 0.91,                                                        â”‚
â”‚      "quality": 0.87,                                                           â”‚
â”‚      "speed": 0.75,                                                             â”‚
â”‚      "robustness": 1.0,                                                         â”‚
â”‚      "num_sources_retrieved": 3                                                 â”‚
â”‚  }                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Function Call Chain

### Complete Call Hierarchy for Objective 5

```
run_evaluation()
â”‚
â”œâ”€â”€ validate_all_prerequisites()
â”‚   â”œâ”€â”€ Check: mistral_model          â—„â”€â”€ Obj 1
â”‚   â”œâ”€â”€ Check: mistral_tokenizer      â—„â”€â”€ Obj 1
â”‚   â”œâ”€â”€ Check: system_prompt          â—„â”€â”€ Obj 1
â”‚   â”œâ”€â”€ Check: qa_database            â—„â”€â”€ Obj 2
â”‚   â”œâ”€â”€ Check: embedding_model        â—„â”€â”€ Obj 3
â”‚   â”œâ”€â”€ Check: faiss_index            â—„â”€â”€ Obj 3
â”‚   â”œâ”€â”€ Check: embed_query()          â—„â”€â”€ Obj 3
â”‚   â”œâ”€â”€ Check: rag_query()            â—„â”€â”€ Obj 4
â”‚   â”œâ”€â”€ Check: search_faiss()         â—„â”€â”€ Obj 4
â”‚   â””â”€â”€ Check: format_context()       â—„â”€â”€ Obj 4
â”‚
â”œâ”€â”€ MetricCalculator.__init__()
â”‚   â”œâ”€â”€ self.embedding_model = globals()['embedding_model']   â—„â”€â”€ Obj 3
â”‚   â””â”€â”€ self.embed_query = globals()['embed_query']           â—„â”€â”€ Obj 3
â”‚
â””â”€â”€ FOR EACH model IN MODELS:
    â”‚
    â””â”€â”€ evaluate_model(model)
        â”‚
        â”œâ”€â”€ pipeline(task_type, model=model_id)    # Load HF model
        â”‚
        â””â”€â”€ FOR EACH question IN TEST_QUESTIONS:
            â”‚
            â””â”€â”€ evaluate_question(question)
                â”‚
                â”œâ”€â”€ get_rag_context(question)
                â”‚   â”‚
                â”‚   â”œâ”€â”€ rag_query(question)                    â—„â”€â”€ Obj 4
                â”‚   â”‚   â”œâ”€â”€ embed_query(question)              â—„â”€â”€ Obj 3
                â”‚   â”‚   â”‚   â””â”€â”€ embedding_model.encode()       â—„â”€â”€ Obj 3
                â”‚   â”‚   â”œâ”€â”€ search_faiss(embedding)            â—„â”€â”€ Obj 4
                â”‚   â”‚   â”‚   â”œâ”€â”€ faiss_index.search()           â—„â”€â”€ Obj 3
                â”‚   â”‚   â”‚   â””â”€â”€ qa_database[indices]           â—„â”€â”€ Obj 2
                â”‚   â”‚   â””â”€â”€ Returns RAGResult
                â”‚   â”‚
                â”‚   â””â”€â”€ format_context(result.retrieved_context) â—„â”€â”€ Obj 4
                â”‚
                â”œâ”€â”€ model_pipeline(question, context)    # Run inference
                â”‚
                â”œâ”€â”€ calculator.calc_accuracy(answer, expected)
                â”‚
                â”œâ”€â”€ calculator.calc_confidence(...)
                â”‚
                â”œâ”€â”€ calculator.calc_quality(answer, expected)
                â”‚   â”œâ”€â”€ embed_query(answer)                    â—„â”€â”€ Obj 3
                â”‚   â”œâ”€â”€ embed_query(expected)                  â—„â”€â”€ Obj 3
                â”‚   â””â”€â”€ cosine_similarity()
                â”‚
                â”œâ”€â”€ calculator.calc_speed(response_time)
                â”‚
                â””â”€â”€ calculator.calc_robustness(...)
```

---

## File Outputs

### Files Created by Each Objective

| Objective | Output Directory | Files |
|-----------|-----------------|-------|
| **Obj 0** | N/A | (Packages installed, no files) |
| **Obj 1** | `data/system_prompt_engineering/` | `system_prompt.txt`, `test_response.txt` |
| **Obj 2** | `data/qa_database/` | `qa_database.csv` |
| **Obj 3** | `data/vector_database/` | `qa_embeddings.npy`, `qa_index.faiss`, `retrieval_test_results.csv` |
| **Obj 4** | `data/rag_pipeline/` | `rag_test_results.csv`, `pipeline_config.txt` |
| **Obj 5** | `./` (root) | `model_rankings.csv` |

### Directory Structure

```
project/
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ system_prompt_engineering/      â—„â”€â”€ Objective 1
â”‚   â”‚   â”œâ”€â”€ system_prompt.txt
â”‚   â”‚   â””â”€â”€ test_response.txt
â”‚   â”‚
â”‚   â”œâ”€â”€ qa_database/                    â—„â”€â”€ Objective 2
â”‚   â”‚   â””â”€â”€ qa_database.csv
â”‚   â”‚
â”‚   â”œâ”€â”€ vector_database/                â—„â”€â”€ Objective 3
â”‚   â”‚   â”œâ”€â”€ qa_embeddings.npy
â”‚   â”‚   â”œâ”€â”€ qa_index.faiss
â”‚   â”‚   â””â”€â”€ retrieval_test_results.csv
â”‚   â”‚
â”‚   â””â”€â”€ rag_pipeline/                   â—„â”€â”€ Objective 4
â”‚       â”œâ”€â”€ rag_test_results.csv
â”‚       â””â”€â”€ pipeline_config.txt
â”‚
â””â”€â”€ model_rankings.csv                  â—„â”€â”€ Objective 5 (Final Output)
```

---

## Quick Reference

### Summary Table

| Objective | Reuses From | Creates | Key Output |
|-----------|-------------|---------|------------|
| **Obj 0** | Nothing | Environment, packages, auth | Ready environment |
| **Obj 1** | Obj 0 | LLM + System Prompt | `mistral_model`, `system_prompt` |
| **Obj 2** | Obj 1 | Knowledge Base | `qa_database` (21 Q&A pairs) |
| **Obj 3** | Obj 2 | Semantic Search | `faiss_index`, `embed_query()` |
| **Obj 4** | Obj 1, 2, 3 | RAG Pipeline | `rag_query()` |
| **Obj 5** | Obj 1, 2, 3, 4 | Evaluation | `model_rankings.csv` |

### For Your Presentation

> **"This system demonstrates 100% component reuse across 6 objectives. Each objective builds upon previous work - Objective 5 reuses components from ALL previous objectives. For example, when evaluating a question:**
>
> 1. **We call `rag_query()` from Objective 4**
> 2. **Which calls `embed_query()` from Objective 3**
> 3. **Which queries the `faiss_index` built from `qa_database` in Objective 2**
> 4. **Using the `system_prompt` from Objective 1**
> 5. **The semantic similarity metric also reuses `embed_query()` rather than calling the embedding model directly**
>
> **This achieves true modular design with zero code duplication."**

---

### Verification Checklist

Before submission, verify each objective:

- [ ] **Obj 0**: Packages installed, `hf_token` set
- [ ] **Obj 1**: `mistral_model`, `mistral_tokenizer`, `system_prompt` in globals
- [ ] **Obj 2**: `qa_database` has 21 pairs (18 answerable + 3 unanswerable)
- [ ] **Obj 3**: `faiss_index.ntotal == 21`, `qa_embeddings.shape == (21, 384)`
- [ ] **Obj 4**: `rag_query()` returns `RAGResult` with retrieved context
- [ ] **Obj 5**: `model_rankings.csv` has 6 models ranked by 5 metrics

---

*Document Version: 1.0*  
*Generated for: RAG System Implementation - Complete Dependency Documentation*